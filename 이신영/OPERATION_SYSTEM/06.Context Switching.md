## 컨텍스트 스위칭 시에는 어떤 일들이 일어나나요?

컨텍스트 스위칭은 운영체제가 CPU에서 실행 중인 프로세스를 다른 프로세스로 교체할 때 발생하는 과정입니다.

**커널(운영체제)**가 실행 중인 프로세스의 상태(레지스터, 프로그램 카운터, 스택 포인터 등)를 **프로세스 제어 블록(PCB)**에 저장합니다. 그 후, 새 프로세스의 PCB에서 상태 정보를 가져와 복구한 후, 해당 프로세스의 실행을 재개합니다. 

### 프로세스와 스레드는 컨텍스트 스위칭이 발생했을 때 어떤 차이가 있을까요?

프로세스 컨텍스트 스위칭는 독립적인 메모리 공간을 교체해야 하므로 비용이 큽니다.
반면, 스레드 컨텍스트 스위칭는 동일한 메모리 공간을 공유하기 때문에 주로 레지스터와 스택 포인터만 교체하면 되어 비용이 적습니다.

> 프로세스 컨텍스트 스위칭 : 페이지 테이블의 교체와 같은 메모리 관리 작업이 필요함 따라서 TLB(Translation Lookaside Buffer) 캐시를 비우거나 업데이트해야 하며 추가비용도 발생
> 스레드 컨텍스트 스위칭 : 데이터 경쟁(race condition)을 방지하기 위한 동기화 메커니즘이 필요할수도있음

![image](https://github.com/user-attachments/assets/d27d3a9e-2287-447d-82f4-f899e82fb049)


### 컨텍스트 스위칭이 발생할 때, 기존의 프로세스 정보는 커널스택에 어떠한 형식으로 저장되나요?

컨텍스트 스위칭 시 기존의 프로세스 정보는 커널 스택에 스택 프레임의 형태로 저장됩니다. 
이 정보에는 레지스터 값, 프로그램 카운터, 스택 포인터, 플래그 레지스터, 메모리 관리 정보 등이 포함됩니다. 커널 스택에 저장된 정보를 활용해 프로세스의 정확한 상태 복구를 가능하게 하며, 프로세스 제어 블록(PCB)과 밀접하게 연관되어 프로세스의 실행 상태를 관리합니다.

> 프로세스는 user stack과 kernel stack을 가지고 있다. 이건 유저, 커널 모드에서 사용하는 스택이다.

### 컨텍스트 스위칭은 언제 일어날까요?

1. 타이머 인터럽트(시간 분할 스케줄링):
시간 제한이 도달하면 운영체제가 현재 실행 중인 프로세스를 중단하고, 다른 준비된 프로세스에 CPU를 할당합니다. 
> 멀티태스킹 환경에서 모든 프로세스가 공정하게 CPU 시간을 얻을 수 있도록 보장

2. I/O 요청 및 완료:
프로세스가 I/O 작업을 요청하여 대기 상태로 전환되거나, 대기 중이던 I/O 작업이 완료되어 준비 상태로 전환될 때 발생합니다.
> CPU가 I/O 작업을 기다리는 동안 유휴 상태에 있지 않고 다른 작업을 처리할 수 있다. 

3. 우선순위 스케줄링:
높은 우선순위를 가진 프로세스가 준비 상태로 전환되면, 현재 실행 중인 프로세스를 중단하고 높은 우선순위 프로세스를 실행하기 위해 컨텍스트 스위칭이 발생합니다.
